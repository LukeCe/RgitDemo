---
title: "Quickstart guide for creating an R package on gitHub"
author: Lukas Dargel
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Quickstart guide for creating an R package on gitHub}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, eval=FALSE}
library("tinytest")
library("usethis")
```


## Setup your Project on GitHub

### Quickstart

```{r, eval=FALSE}
# 0) optionally write default settings into your R profile
usethis::edit_r_profile()
usethis::edit_r_environ()

# 1) create this project
usethis::create_package("/Projects/Packages/RgitDemo")

# 2) create this vignette
usethis::use_vignette("Quickstart_R_package_on_gitHub", title = "Quickstart guide for creating an R package on gitHub")

# 3) initialize git
usethis::use_github()

# 4) create your first function
usethis::use_r("utils_list.R")

# 5) invite your collaborators to fork your repo and start working together.
```

### Some explanations


**Prerequisites** create an account on gitHub and download the RStudio IDE.

**In step 0** we may set some default values.

+ If you do not have already a GitHub token create it with `usethis::create_github_token()`.
+ Store the token inside RStudio by calling `gitcreds::gitcreds_set()` then pasting the token. 
This allows to use the gui to push and pull directly from the RStudio IDE.
+ Above works if you use the https protocol to communicate with gitHUB. Alternatively you can use the ssh protocol which requires to create an ssh key pair and upload the public key to your github account.

```{bash}
# check which remote you are using
git remote -v

# to change from https to ssh use
git remote set-url origin git@github.com:LukeCe/RgitDemo.git

# to change from ssh to https use
git remote set-url origin https://github.com/LukeCe/RgitDemo.git
```

+ 

**In step 1** we create a minimal R package based on RStudio projects


**In step 2** we create a template for an vignette based on Rmarkdown


**In step 3** we initialize git, start version control.


**In step 4** we create an R-script in the R directory and add a first function to our package.

**From Step 5 onward** we start to develop the project collectively.
At this point it is recommended not to make any changes directly on the master/main branch.
Instead we use branches and forks to develop new functionality and merge them into the main branch via pull requests, which are explained in the next section.

## Start collaborative development

The master or main branch of on a repository corresponds to the development version of the code.
This version can is available to users who can experiment with new functionality and share their experience with the authors.
Once the maintainers are satisfied the will be packaged into a release version.

Although the development version does usually not grantee stability, it should have high standards.
For this reason direct commits to the master branch are discouraged.
Instead, the contributors to a project develop their functionality in a different branch.
Only when the implementation of the new feature is satisfactory they make a pull request, which invites the maintainers to merge their contribution into the main branch.

The pull request workflow has the advantage that maintainers can easily review the new code and handle the merge directly in gitHub.
In case of merge conflicts the maintainer and contributor is notified and they can decide how to resolve them.
In most cases the contributor is asked revise their code until the merge can proceed without conflicts.

### Start to contribute to a collaborative project

1. Fork the original repository (called upstream) on your own gitHub
2. Clone the fork into your local environment.
3. Make a branch for your feature and push the branch to your fork
4. Once the feature is ready open a pull request on github inviting the maintainer to copy your branch on merge it into hist master



### Some explanations

A fork is 


### A note for the maintainer


As a maintainer you can either fork your own repository and use the same model as for contributors or you develop directly on a branch of the original repository.

The maintainer of a project can choose the same model for contributing to the project as any other contributor.
In this he has to fork his own repository which is not directly supported by github.
We can work around this creating a second account or by replacing the first two steps in above workflow by the following five:

+ Create an empty github repository e.g. RgitDemo_fork
+ Clone this repository `git clone git@github.com:LukeCe/RgitDemo_fork`
+ Add the original repository as an upstream `git remote add upstream git@github.com:LukeCe/RgitDemo`
+ Pull the master branch from upstream `git pull upstream master`
+ Push the master branch to your fork `git push origin master`


Alternatively the maintainer can continue to develop in the original repository.
In any case new features should be developed in branches and not directly on the master.
Once the feature is ready it can either be merged locally or pushed to github and merged via a pull request.
One disadvantage of this model is that the upstream repository may have multiple branches which may be confusing for new contributors and users interested in the development version of the software.


## Automation of tasks

### Building the package website

```{r, eval=FALSE}
usethis::use_pkgdown_github_pages()
usethis::use_github_action("pkgdown")
```

### R CMD check

### Unit testing


## Additional resources

- https://happygitwithr.com/
- https://pandammonium.org/how-to-change-a-git-repository-from-https-to-ssh/
- https://deanmalone.net/post/how-to-fork-your-own-repo-on-github/
- https://www.tinyverse.org/
